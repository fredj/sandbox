<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <link rel="stylesheet" href="http://openlayers.org/dev/theme/default/style.css" type="text/css" />
    <link rel="stylesheet" href="http://openlayers.org/dev/examples/style.css" type="text/css" />
    <script src="http://openlayers.org/dev/OpenLayers.js"></script>
    <script src="Image.js"></script>
    <style>
      .olTileImage {
          opacity: 1;
          -webkit-transition: opacity 0.2s linear;
          -moz-transition: opacity 0.2s linear;
          -o-transition: opacity 0.2s linear;
          transition: opacity 0.2s linear;
      }

      .olImageLoading {
          opacity: 0;
      }

    </style>
    <script type="text/javascript">
        var map;

        function init() {
            map = new OpenLayers.Map('map');

            map.addLayer(new OpenLayers.Layer.WMS("OpenLayers WMS", "http://vmap0.tiles.osgeo.org/wms/vmap0", {
                layers: 'basic'
            }));
            map.setCenter(new OpenLayers.LonLat(5, 50), 5);
        }
    </script>
  </head>
  <body onload="init()">
    <h1 id="title"><a href="http://leaflet.cloudmade.com/">leaflet</a> fade animation</h1>

    <p id="shortdesc"></p>

    <div id="map" style="background-color: white;" class="smallmap"></div>
    <pre>
Index: theme/default/style.css
===================================================================
--- theme/default/style.css     (revision 12311)
+++ theme/default/style.css     (working copy)
@@ -8,6 +8,18 @@
 div.olMapViewport {
     text-align: left;
 }
+.olTileImage {
+    opacity: 1;
+    
+    -webkit-transition: opacity 0.2s linear;
+    -moz-transition: opacity 0.2s linear;
+    -o-transition: opacity 0.2s linear;
+    transition: opacity 0.2s linear;
+}
+ 
+.olImageLoading {
+    opacity: 0;
+}
 
 div.olLayerDiv {
    -moz-user-select: none;
Index: lib/OpenLayers/Tile/Image.js
===================================================================
--- lib/OpenLayers/Tile/Image.js        (revision 12311)
+++ lib/OpenLayers/Tile/Image.js        (working copy)
@@ -205,7 +205,7 @@
             if (this.frame.parentNode === this.layer.div) {
                 this.layer.div.removeChild(this.frame);
             }
-            this.setImgSrc();
+            img.src = this.blankImageUrl;
             if (this.layerAlphaHack === true) {
                 img.style.filter = "";
             }
@@ -240,7 +240,6 @@
             style.width = "100%";
             style.height = "100%";
         }
-        style.display = "none";
         if (this.layer.opacity < 1) {
             OpenLayers.Util.modifyDOMElement(img, null, null, null, null, null,
                 null, this.layer.opacity);
@@ -301,10 +300,9 @@
      * url - {String} or undefined to hide the image
      */
     setImgSrc: function(url) {
-        var img = this.imgDiv;
-        img.style.display = "none";
         if (url) {
-            img.src = url;
+            OpenLayers.Element.addClass(this.imgDiv, "olImageLoading");
+            this.imgDiv.src = url;
         }
     },
     
@@ -340,7 +338,7 @@
     onImageLoad: function() {
         var img = this.imgDiv;
         OpenLayers.Event.stopObservingElement(img);
-        img.style.display = "";
+        OpenLayers.Element.removeClass(img, "olImageLoading");
         this.isLoading = false;
         this.events.triggerEvent("loadend");
    </pre>
  </body>
</html>




